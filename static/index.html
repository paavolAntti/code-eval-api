<!DOCTYPE html>
<html lang="en">
    <head>
        <title>API Test Site</title>
        <meta charset="utf-8">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
    </head>
    <body>
        <h1>Toisto</h1>
        <p>Tehtäväsi on selvittää, kuinka pitkä on lyhin merkkijono, jota toistamalla voidaan muodostaa annettu merkkijono.</p>
        <p>Esimerkiksi kun merkkijono on abcabcabcabc, lyhin toistettava merkkijono on abc.</p>
        <p>Merkkijono muodostuu merkeistä a–z ja siinä on enintään 100 merkkiä.</p>
        <h3>Tehtävä</h3>
        <p>Kirjoita ohjelmasi tiedostoon repeat.cpp. Ohjelman tulee sisältää funktio Repeat, joka ottaa parametrina merkkijonon ja palauttaa kokonaisluvun</p>
        
        <form id='upload_form' enctype="multipart/form-data" method="POST"> 
	   		<input id='file_upload' type="file" name="file_upload" />
	   		<input type="submit" value="Upload a file"/>
		</form>
        <h1>Onnenluku</h1>
        <p>Luku on onnekas, jos sen numeroiden summa on jaollinen seitsemällä.</p>
        <p>Esimerkiksi luku 16 on on onnekas, koska 1+6 = 7, joka on jaollinen 7:llä</p>
        <p>Tehtäväsi on kirjoittaa funktio joka tarkistaa onko luku onnekas</p>
        <h3>Tehtävä</h3>
        <p>Kirjoita ohjelmasi tiedostoon lucky.cpp. Ohjelman tulee sisältää funktio Lucky, joka ottaa parametrina kokonaisluvun(integer) ja palauttaa totuusarvon (boolean)</p>
        
        <form id='upload_form2' enctype="multipart/form-data" method="POST"> 
	   		<input id='file_upload2' type="file" name="file_upload2" />
	   		<input type="submit" value="Upload a file"/>
		</form>
        <div id='testing_info'>
            
        </div>
		<div id='result_container'>
		</div>
    </body>
</html>

<script>
const baseURI = 'http://localhost:3003';

const showResult = (data) => {
	if (data.stdout != "") {
        const partsOut = data.stdout.split("\n");
        $('#result_container').empty().append('<h2>Results: </h2>');
        let startPrint = false;
        partsOut.forEach(element => {
            console.log(element);
            if (element.includes("[==========]")) startPrint = true;
            if (startPrint) $('#result_container').append(`<p>${element}</p>`);
        });
        
	}
	if (data.stderr != "") {
        const partsErr = data.stderr.split("\n");
		$('#result_container').append('<h2>Errors/Warnings: </h2>');
        partsErr.forEach(element => {
            $('#result_container').append(`<p>${data.stderr}</p>`);
        });
        
        
	}
}
$('#upload_form').on('submit', (e) => {
    e.preventDefault();
    $('#testing_info').empty().append("<h2>Testing...</2>");
    console.log('uploading a file');
    const file = document.getElementById('file_upload');
    let formData = new FormData();
    formData.append('file_upload', file.files[0]);
    console.log(file.files[0]);
    $.ajax({
        url: `${baseURI}/api/file/upload`,
        data: formData,
        cache: false,
        contentType: false,
        processData: false,
        method: 'POST',
        type: 'POST', // For jQuery < 1.9
        success: function(data){
            $('#testing_info').empty();
            console.log(data);
            showResult(data);
        }
    });
});
$('#upload_form2').on('submit', (e) => {
    e.preventDefault();
    $('#testing_info').empty().append("<h2>Testing...</2>");
    console.log('uploading a file');
    const file = document.getElementById('file_upload2');
    let formData = new FormData();
    formData.append('file_upload', file.files[0]);
    console.log(file.files[0]);
    $.ajax({
        url: `${baseURI}/api/file/upload`,
        data: formData,
        cache: false,
        contentType: false,
        processData: false,
        method: 'POST',
        type: 'POST', // For jQuery < 1.9
        success: function(data){
            $('#testing_info').empty();
            console.log(data);
            showResult(data);
        }
    });
});
</script>